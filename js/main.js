const catalog={"Ø´Ø±Ù‚ÙŠ (ÙƒÙŠÙ„Ùˆ)":[{name:"Ø¨Ø³Ø¨ÙˆØ³Ø© Ø³Ø§Ø¯Ø©",price:195},{name:"Ø¨Ø³Ø¨ÙˆØ³Ø© Ø¨Ù†Ø¯Ù‚",price:235},{name:"Ø¨Ø³Ø¨ÙˆØ³Ø© Ø¨Ù†Ø¯Ù‚ Ù…Ø¬Ø±ÙˆØ´",price:320},{name:"Ø¨Ø³Ø¨ÙˆØ³Ø© Ù‚Ø´Ø·Ø©",price:450},{name:"Ø¨Ø³Ø¨ÙˆØ³Ø© Ù…ØºØ±Ø¨ÙŠ",price:165},{name:"Ø¨Ø³Ø¨ÙˆØ³Ø© Ù…Ø§Ù†Ø¬Ùˆ",price:275},{name:"ÙƒÙ†Ø§ÙØ© Ø¨ÙˆØ±Ù…Ø© Ø¨Ù†Ø¯Ù‚",price:190},{name:"ÙƒÙ†Ø§ÙØ© Ø¨ÙˆØ±Ù…Ø© ÙØ³ØªÙ‚",price:275},{name:"ÙƒÙ†Ø§ÙØ© Ø¨ÙˆØ±Ù…Ø© Ø³ÙˆØ¯Ø§Ù†ÙŠ",price:320},{name:"ÙƒÙ†Ø§ÙØ© Ø¨ØµÙ…Ø© ÙØ³ØªÙ‚",price:545},{name:"ÙƒÙ†Ø§ÙØ© Ø¨ØµÙ…Ø© Ø¨Ù†Ø¯Ù‚",price:915},{name:"ÙƒÙ†Ø§ÙØ© Ø¨ØµÙ…Ø© Ø¹ÙŠÙ† Ø¬Ù…Ù„",price:625},{name:"ÙƒÙ†Ø§ÙØ© Ø¨ØµÙ…Ø© Ø³ÙˆØ¯Ø§Ù†ÙŠ",price:990},{name:"ÙƒÙ†Ø§ÙØ© Ø³ÙŠØ¬Ø§Ø± Ø³Ø§Ø¯Ø©",price:270},{name:"ÙƒÙ†Ø§ÙØ© Ø³ÙŠØ¬Ø§Ø± Ø¨Ù†Ø¯Ù‚",price:340},{name:"ÙƒÙ†Ø§ÙØ© Ø³ÙŠØ¬Ø§Ø± Ø³Ù…ÙŠØ¯",price:350},{name:"ÙƒÙ†Ø§ÙØ© Ø³ÙŠØ¬Ø§Ø± ÙØ³ØªÙ‚",price:265},{name:"ÙƒÙ†Ø§ÙØ© Ø³ÙˆØ§Ø±ÙŠÙ‡",price:875},{name:"ÙƒÙ†Ø§ÙØ© Ø³ÙˆØ§Ø±ÙŠÙ‡ Ø¨Ù†Ø¯Ù‚",price:675},{name:"ÙƒÙ†Ø§ÙØ© Ø³ÙˆØ§Ø±ÙŠÙ‡ ÙØ³ØªÙ‚",price:585},{name:"ÙƒÙ†Ø§ÙØ© Ø³ÙˆØ§Ø±ÙŠÙ‡ Ù„ÙˆØ²",price:285},{name:"ÙƒÙ†Ø§ÙØ© Ø³ÙˆØ§Ø±ÙŠÙ‡ ÙƒØ±ÙŠÙ…Ø© ÙØ³ØªÙ‚",price:915},{name:"ÙƒÙ†Ø§ÙØ© Ø³ÙˆØ§Ø±ÙŠÙ‡ Ù…Ø´ÙƒÙ„",price:420},{name:"ÙƒÙ†Ø§ÙØ© Ù…Ø§Ù†Ø¬Ø§",price:285},{name:"ÙƒÙ†Ø§ÙØ© Ù‚Ø´Ø·Ø©",price:310},{name:"Ù…ØºØ´ÙˆØ´Ø© Ø³Ø§Ø¯Ø©",price:400},{name:"Ù…ØºØ´ÙˆØ´Ø© ÙØ³ØªÙ‚",price:255},{name:"Ù…ØºØ´ÙˆØ´Ø© Ù…ÙƒØ³Ø±Ø§Øª",price:295},{name:"Ø¨Ø³ÙŠÙ…Ø© Ø³Ø§Ø¯Ø©",price:165},{name:"Ø¨Ø³ÙŠÙ…Ø© Ø¨Ù†Ø¯Ù‚",price:320},{name:"Ù‡Ø±ÙŠØ³Ù‡ Ø³Ø§Ø¯Ù‡",price:265},{name:"Ù‡Ø±ÙŠØ³Ø© Ø¨Ù†Ø¯Ù‚",price:340},{name:"Ù‡Ø±ÙŠØ³Ø© Ø¨Ø§Ø±Ø¯Ø©",price:275},{name:"Ø§Ù„Ø´ÙƒÙ„Ù…Ø©",price:360}],"ØºØ±Ø¨ÙŠ/ØªØ±ÙŠÙ„ØªØ´ÙŠ":[{name:"ØªØ±ÙŠÙ„ØªØ´Ù‰ Ø§ÙˆØ±ÙŠÙˆ",price:200},{name:"ØªØ±ÙŠÙ„ØªØ´Ù‰ ØªØ±Ø§Ù…ÙŠØ³Ùˆ",price:200},{name:"ØªØ±ÙŠÙ„ØªØ´Ù‰ ÙƒØ±Ø§Ù…ÙŠÙ„",price:200},{name:"ØªØ±ÙŠÙ„ØªØ´Ù‰ Ù„ÙˆØªØ³",price:200},{name:"ØªØ±ÙŠÙ„ØªØ´Ù‰ Ù…Ø§Ù†Ø¬Ùˆ",price:200},{name:"ØªØ±ÙŠÙ„ØªØ´Ù‰ Ù†ÙˆØªÙŠÙ„Ø§",price:200}]};const el={editIndex:document.getElementById("editIndex"),customerName:document.getElementById("customerName"),phone:document.getElementById("phone"),address:document.getElementById("address"),notes:document.getElementById("notes"),categorySelect:document.getElementById("categorySelect"),productSelect:document.getElementById("productSelect"),qty:document.getElementById("qty"),price:document.getElementById("price"),imageInput:document.getElementById("imageInput"),previewImage:document.getElementById("previewImage"),cartTable:document.getElementById("cartTable"),totalPrice:document.getElementById("totalPrice"),search:document.getElementById("search"),ordersTable:document.getElementById("ordersTable"),invoiceTemplate:document.getElementById("invoiceTemplate"),btnAddItem:document.getElementById("btnAddItem"),btnClearCart:document.getElementById("btnClearCart"),btnSaveOrder:document.getElementById("btnSaveOrder"),btnNewOrder:document.getElementById("btnNewOrder"),btnClearAll:document.getElementById("btnClearAll")};for(const k in el){if(!el[k]){console.error("Missing element:",k);alert("ÙÙŠ Ø¹Ù†ØµØ± Ù†Ø§Ù‚Øµ ÙÙŠ Ø§Ù„ØµÙØ­Ø©. ØªØ£ÙƒØ¯ Ø¥Ù†Ùƒ Ù†Ø§Ø³Ø® index.html Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ.");break}}
let cart=[];let orders=JSON.parse(localStorage.getItem("orders"))||[];let imageData="";function saveToLS(){localStorage.setItem("orders",JSON.stringify(orders))}
function fileToBase64(file){return new Promise((resolve)=>{if(!file)return resolve("");const reader=new FileReader();reader.onload=()=>resolve(reader.result);reader.readAsDataURL(file)})}
function loadCategories(){el.categorySelect.innerHTML="";Object.keys(catalog).forEach((cat)=>{el.categorySelect.innerHTML+=`<option value="${cat}">${cat}</option>`});loadProducts(el.categorySelect.value)}
function loadProducts(category){const list=catalog[category]||[];el.productSelect.innerHTML="";list.forEach((p)=>{el.productSelect.innerHTML+=`<option value="${p.name}" data-price="${p.price}">${p.name}</option>`});updatePrice()}
function updatePrice(){const opt=el.productSelect.selectedOptions[0];el.price.value=opt?(opt.dataset.price||""):""}
function renderCart(){el.cartTable.innerHTML="";let sum=0;cart.forEach((item,i)=>{sum+=item.total;el.cartTable.innerHTML+=`
      <tr>
        <td>${item.product}</td>
        <td>${item.qty}</td>
        <td>${item.price}</td>
        <td>${item.total}</td>
        <td><button class="btn btn-danger btn-sm" data-remove="${i}">âŒ</button></td>
      </tr>
    `});el.totalPrice.textContent=String(sum)}
function addItemToCart(){const product=el.productSelect.value;const qty=Number(el.qty.value);const price=Number(el.productSelect.selectedOptions[0]?.dataset?.price||0);if(!product)return alert("Ø§Ø®ØªØ§Ø± ØµÙ†Ù");if(!qty||qty<=0)return alert("Ø§ÙƒØªØ¨ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©");cart.push({product,qty,price,total:qty*price});renderCart()}
function clearCart(){cart=[];renderCart()}
async function handleImageChange(){const file=el.imageInput.files[0];imageData=await fileToBase64(file);if(imageData){el.previewImage.src=imageData;el.previewImage.style.display="block"}else{el.previewImage.style.display="none"}}
async function saveOrder(){if(!el.customerName.value.trim())return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„");if(!el.phone.value.trim())return alert("Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„");if(!el.address.value.trim())return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†");if(cart.length===0)return alert("Ù„Ø§Ø²Ù… ØªØ¶ÙŠÙ Ù…Ù†ØªØ¬ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");const idx=el.editIndex.value===""?null:Number(el.editIndex.value);if(idx!==null&&!imageData){imageData=orders[idx]?.image||""}
const order={id:idx!==null?orders[idx].id:Date.now(),customer:el.customerName.value.trim(),phone:el.phone.value.trim(),address:el.address.value.trim(),notes:el.notes.value.trim(),cart:[...cart],total:Number(el.totalPrice.textContent||0),image:imageData||""};if(idx===null){orders.push(order)}else{orders[idx]=order}
saveToLS();resetForm();renderOrders();alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø£ÙˆØ±Ø¯Ø± ÙˆØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ØªØ­Øª")}
function resetForm(){el.editIndex.value="";el.customerName.value="";el.phone.value="";el.address.value="";el.notes.value="";el.qty.value=1;cart=[];imageData="";el.imageInput.value="";el.previewImage.style.display="none";renderCart()}
function renderOrders(){const q=(el.search.value||"").toLowerCase();el.ordersTable.innerHTML="";orders.forEach((o,i)=>{if(!o.customer.toLowerCase().includes(q))return;const img=o.image?`<img src="${o.image}" class="table-img" alt="order">`:"â€”";el.ordersTable.innerHTML+=`
      <tr>
        <td>${i + 1}</td>
        <td>${img}</td>
        <td>${o.customer}</td>
        <td>${o.phone}</td>
        <td>${o.address}</td>
        <td>${o.total}</td>
        <td><button class="btn btn-warning btn-sm" data-edit="${i}">âœï¸</button></td>
        <td><button class="btn btn-secondary btn-sm" data-print="${i}">ğŸ–¨</button></td>
        <td><button class="btn btn-danger btn-sm" data-del="${i}">ğŸ—‘</button></td>
      </tr>
    `})}
function editOrder(i){const o=orders[i];el.customerName.value=o.customer;el.phone.value=o.phone;el.address.value=o.address;el.notes.value=o.notes;cart=[...o.cart];imageData=o.image||"";if(imageData){el.previewImage.src=imageData;el.previewImage.style.display="block"}else{el.previewImage.style.display="none"}
el.editIndex.value=String(i);renderCart();window.scrollTo({top:0,behavior:"smooth"})}
function deleteOrder(i){if(!confirm("Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø£ÙˆØ±Ø¯Ø±ØŸ"))return;orders.splice(i,1);saveToLS();renderOrders()}
function printInvoice(i){const o=orders[i];const container=document.createElement("div");container.innerHTML=el.invoiceTemplate.innerHTML;container.querySelector("#invOrderId").textContent=i+1;container.querySelector("#invName").textContent=o.customer;container.querySelector("#invPhone").textContent=o.phone;container.querySelector("#invAddress").textContent=o.address;container.querySelector("#invTotal").textContent=o.total;const itemsBody=container.querySelector("#invItems");itemsBody.innerHTML="";o.cart.forEach((item)=>{itemsBody.innerHTML+=`
      <tr>
        <td>${item.product}</td>
        <td>${item.qty}</td>
        <td>${item.price}</td>
        <td>${item.total}</td>
      </tr>
    `});const w=window.open("","","width=420,height=650");w.document.open();w.document.write(`
    <html dir="rtl" lang="ar">
      <head>
        <meta charset="UTF-8" />
        <title>ÙØ§ØªÙˆØ±Ø©</title>
      </head>
      <body>${container.innerHTML}</body>
    </html>
  `);w.document.close();w.focus();w.print()}
el.categorySelect.addEventListener("change",()=>loadProducts(el.categorySelect.value));el.productSelect.addEventListener("change",updatePrice);el.imageInput.addEventListener("change",handleImageChange);el.btnAddItem.addEventListener("click",addItemToCart);el.btnClearCart.addEventListener("click",clearCart);el.btnSaveOrder.addEventListener("click",saveOrder);el.btnNewOrder.addEventListener("click",resetForm);el.search.addEventListener("input",renderOrders);el.btnClearAll.addEventListener("click",()=>{if(!confirm("Ù…ØªØ£ÙƒØ¯ØŸ Ù‡ÙŠÙ…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§"))return;orders=[];saveToLS();renderOrders()});el.cartTable.addEventListener("click",(e)=>{const btn=e.target.closest("button[data-remove]");if(!btn)return;const index=Number(btn.dataset.remove);cart.splice(index,1);renderCart()});el.ordersTable.addEventListener("click",(e)=>{const editBtn=e.target.closest("button[data-edit]");const delBtn=e.target.closest("button[data-del]");const printBtn=e.target.closest("button[data-print]");if(editBtn)return editOrder(Number(editBtn.dataset.edit));if(delBtn)return deleteOrder(Number(delBtn.dataset.del));if(printBtn)return printInvoice(Number(printBtn.dataset.print))});loadCategories();renderCart();renderOrders()